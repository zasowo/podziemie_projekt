---
//if (!Astro.locals.user?.id) return Astro.redirect('/signin')
const userId = Astro.locals.user?.id ?? null;
---
<div id="user-context" data-user-id={userId}></div>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
  </head>
  <body>
    Użytkownik: {JSON.stringify(Astro.locals.user)}
    <button disabled id="signOutButton">Wyloguj się</button>
    <button disabled id="loginButton">Zaloguj się</button>
    <button disabled id="registerButton">Utwórz konto</button>
    <div>Strona główna</div>
    <script>
      import { authClient } from '@/auth-client'
      const userID = document.getElementById('user-context')?.dataset.userId;
      console.log(userID)
      
      if (userID) {
        document.getElementById('signOutButton')?.removeAttribute('disabled');
        document.getElementById('signOutButton')?.addEventListener('click', async () => {
          await authClient.signOut()
          window.location.href = '/signin'
        })
      } else {

        document.getElementById('loginButton')?.removeAttribute('disabled');
        document.getElementById('loginButton')?.addEventListener('click', async () => {
          window.location.href = '/signin'
        })
        document.getElementById('registerButton')?.removeAttribute('disabled');
        document.getElementById('registerButton')?.addEventListener('click', async () => {
          window.location.href = '/signup'
        })
      }
      
    </script>
  </body>
</html>